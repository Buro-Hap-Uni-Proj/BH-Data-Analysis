---
title: "BH Analysis"
author: "Marc"
date: "28/02/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document.

Required Libraries:
```{r}
library(ggplot2)
library(dplyr)
library(tidyr)
library(data.table)
```

Getting File:
```{r}
#Depending on Computer:
setwd('/users/marckennedy/desktop')
getwd()
#setwd('/Users/Marc/Desktop')
BHData<-read.csv(file='BHDATA.csv')
#BHData
```

Converting Time:
```{r}
BHData$datetime<-as.POSIXct((BHData$time)/1000, origin="1970-01-01")
```

Separating Position:
```{r}
BHData$datetime<-as.POSIXct((BHData$time)/1000, origin="1970-01-01")
BH<- data.frame(separate(BHData,position, c("X", "Y"),","))
BH$X2<-as.numeric(gsub("\\[","",BH$X))
BH$Y2<-as.numeric(gsub("\\]","",BH$Y))
```

Tidying Up Data:
```{r}
BH$uuid<-NULL
BH$direction<-NULL
BH$X<- BH$X2
BH$Y<- BH$Y2
BH$X2<- NULL
BH$Y2<- NULL
BH$position<- BHData$position
```


Plot (position over time):
```{r}
#ggplot(data = BH, aes(x= -Y,y=-X,color= datetime)) +
  #geom_point(alpha=1/100)
```
Test Data (1000 rows):
```{r}
#BHT<-subset(BH, BH$id<4134925)
#BHT$irlynx_id<-as.character(BHT$irlynx_id)
#str(BHT)
```

Journey Time:
```{r}
maxtime<-data.frame(tapply(BH$datetime,BH$irlynx_id,max))
mintime<-data.frame(tapply(BH$datetime,BH$irlynx_id,min))
journeys<-merge(maxtime,mintime,by ="row.names")
journeys$irlynx_id<-journeys$Row.names
journeys$Row.names<-NULL
journeys$max<-journeys$tapply.BH.datetime..BH.irlynx_id..max.
journeys$tapply.BH.datetime..BH.irlynx_id..max.<-NULL
journeys$min<-journeys$tapply.BH.datetime..BH.irlynx_id..min.
journeys$tapply.BH.datetime..BH.irlynx_id..min.<-NULL
journeys$journeytime<-(journeys$max-journeys$min)
sum(journeys$journeytime)/3600
```

Number of Employees per timestamp:
```{r}
times<-group_by(BH,time)
timeinfo<-summarise(times,
                    n=n())
timeinfo$Ntime<-as.POSIXct((timeinfo$time)/1000, origin="1970-01-01")
timeinfo$Ntod <- as.ITime(timeinfo$Ntime)
timeinfo$Ndate <- as.IDate(timeinfo$Ntime)
timeinfo$date <- as.numeric(as.POSIXct(timeinfo$date))
timeinfo$timeofday<-(timeinfo$time-timeinfo$date*1000)
summary(timeinfo$n)
# ggplot(data=timeinfo,aes(x=timeofday,y=n))+geom_point()

```

(OLD) Number of Employees:
```{r}
# BH$irlynx_id<-as.character(BH$irlynx_id)
# by(BH$id,BH$time,mean)
# ?tally
# n<-data.frame(tapply(BH$irlynx_id,as.factor(BH$time),tally))
# df<-subset(BH,BH$id<10)
# test<-BH %>% select(irlynx_id, datetime) %>% 
#      group_by(datetime) %>% 
#      mutate(irlynx_id.count = n()) %>% 
#      slice(1)
# library(data.table)
# test
# test$timeofday <- as.ITime(test$datetime)
# test$date<-as.IDate(test$datetime)
# max(test$irlynx_id.count)
# mean(test$irlynx_id.count)
# ggplot(data=test,aes(y=irlynx_id.count,x=datetime))+geom_point()
# oneday<-head(test,1000)
# ggplot(data=oneday,aes(x=oneday$timeofday,y=oneday$irlynx_id.count))+
#   geom_line()+
#   scale_x_continuous(breaks = seq(min(oneday$timeofday),max(oneday$timeofday),30))+
#   scale_y_continuous(breaks = seq(0,70,1))
```


